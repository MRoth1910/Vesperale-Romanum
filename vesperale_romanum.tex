% !TEX TS-program = lualatexmk
% !TEX parameter =  --shell-escape

\documentclass[11pt]{book}
\input{commonheaders.tex}

%%for calendar
\usepackage{showframe}

\usepackage{ragged2e}
%\usepackage{geometry}
%\usepackage[parfill]{parskip}

%\usepackage{parskip}

\usepackage{longtable}
\usepackage{multirow,makecell}

\usepackage{colortbl}

\NewDocumentCommand\hang{}{\setlength{\hangindent}{10pt}}
\NewDocumentCommand\mem{m}{\textit{Comm.} #1}
\NewDocumentCommand\gcolor{m}{\textcolor{gregoriocolor}{#1}} 

\externaldocument[M-]{\subfix{vesperale_romanum}}

\begin{document}
%% order TBD.
%%%github version%%%

%%section titles need to be on new page which should happen if we restrict section to start of new subfile only BUT subsection* and sectiion* need same treatment
%%do we want to use section* or special festum command?
\customsubfile{vr_01_prolegomena} %%these probably WILL be 01
%%need to remove \mainmatter command and put it at end of whatever 02 is
 %%these probably WILL be 01; include Kalendarium in prologomena file eventually
%%need to remove \mainmatter command and put it at end of whatever 02 is
\customsubfile{vr_02_toni_communes} %%watch for hfull boxes in ALT, e.g. in collect examples; %%do we put in psalm tone examples…%%descenders are problem%%
\customsubfile{vr_03_canticum_bmv} %%ALT works for Toni Communes, not so much for psalm endings
\customsubfile{vr_04_tempus_adventus}
\customsubfile{vr_05_in_nativitate_usque_5_jan}
\customsubfile{vr_06_octavae_epiphaniae}
\customsubfile{vr_07_tempus_post_epiphaniam}
\customsubfile{vr_08_tempus_septuagesimae}
\customsubfile{vr_09_tempus_quadragesimae_passionis}
\customsubfile{vr_10_tempus_paschale}
\customsubfile{vr_11_trinitate_ad_sc}
\customsubfile{vr_12_sab_post_pentecosten}
\customsubfile{vr_13_dom_post_pentecosten}
\customsubfile{vr_14_in_commemorationibus_sanctorum} %% for now doctor's names work
\customsubfile{vr_15_psalterium}
%%Te Lucis BVM is problem
%% commemorationes sanctorum %% to adjust
%% common commemorations %% to adjust but otherwise done (can be considered redundant though) 
%% the psalter + commemorations (of saints and suffrages) are middle of book
%%books start with Saint Andrew and end before the vigil
\customsubfile{vr_16_festa_decembris}
\customsubfile{vr_17_festa_januarii}
\customsubfile{vr_18_festa_februarii}
\customsubfile{vr_19_festa_martii}
\customsubfile{vr_20_festa_aprilis}
\customsubfile{vr_21_festa_maii}
\customsubfile{vr_22_festa_junii}
\customsubfile{vr_23_festa_julii}
\customsubfile{vr_24_festa_augusti}
\customsubfile{vr_25_festa_septembris}
\customsubfile{vr_26_festa_octobris}
\customsubfile{vr_27_festa_novembris}
\customsubfile{vr_28_commune_apostolorum}
\customsubfile{vr_29_commune_unius_martyris}
\customsubfile{vr_30_commune_apostolo_evang_martyrum_tp}
\customsubfile{vr_31_commune_plurimorum_martyrum_extra_tp}
\customsubfile{vr_32_commune_confessoris_pontificis} %%doctors' names are a problem as is Iste confessor (sometimes) (Names working as of Oct 8 2024!!
\customsubfile{vr_33_commune_confessoris_non_pontificis}
\customsubfile{vr_34_commune_virginum} %%J in hymn is problem (fixed as of Oct 2024)
\customsubfile{vr_35_commune_non_virginum}
\customsubfile{vr_36_commune_dedicationis}
\customsubfile{vr_37_commune_bmv} % % % need to ensure spacing at antiphon Sancta Maria
\customsubfile{vr_38_bmv_in_sabbato}
\customsubfile{vr_39_officium_parvum}
\customsubfile{vr_40_officium_defunctorum}
\customsubfile{vr_41_varia}
\customsubfile{vr_42_hymni_antiqui} 
\customsubfile{vr_43_proprium_galliae}
\customsubfile{vr_44_pius_12_1960}
\customsubfile{vr_45_variationes} %% Rubrical changes up to 1960%%\newpage

\addcontentsline{toc}{chapter}{Indices}
\cprintindex{A}{index antiphonarum.}
\cprintindex{H}{index hymnorum.}
\cprintindex{P}{index psalmorum.}
\cprintindex{V}{index variorum.}
\cprintindex{F}{index festorum.}

\tableofcontents
\thispagestyle{empty}

%% need to decide on default indention (i.e. none) after sectioning commands or use \indent\indent

%% can't forget that the pageref is often the page after the incipit (bad!): index, so long as it's before score, should work out, but pageref is tricky

%%babel always has c-t, p-t, om-n division. we want  -ct, -pt, o-mn

%%section title can never begin at bottom of page, but we don't always want empty style (big feasts, new "chapter" only)
%% can never split day (e.g. Feria VI post…)/date, rank, octave from feast title

%%can never split IN I (II) VESPERIS or similar, but they can be split from rubrics (probably?)

%% ALT with descenders (normally p and y) particularly in italics causes issues on second pass. 1st pass is perfect. but default tends to make the score too big. Will need to carefully scrutinize lines in certain scores lest the pages be too stretched. This is a problem for common tones and for Magnificats with tone endings printed as in Liber Usualis.

%%\lettrine[depth=1] should probably be used consistently with Q (collects starting "Quaesumus")

%%need to check offset of asterisk in antiphons; the (default) new barspacing algorithm works, but e.g. Sicut novellae of Corpus Christi has the asterisk to the far right of the quarter bar, when in this case it should be aligned neatly
%%too far to tthe left in certain mode 1 antiphons

%%most but not all feasts don't need label at I or II Vespers

%%can never split IN I (II) VESPERIS or similar, but they can be split from rubrics (probably?)

%% ALT with descenders (normally p and y) particularly in italics causes issues on second pass. 1st pass is perfect. but default tends to make the score too big. Will need to carefully scrutinize lines in certain scores lest the pages be too stretched. This is a problem for common tones and for Magnificats with tone endings printed as in Liber Usualis.

%% verse numbers of hymn always need to go on next line…early gregorio user input needs to be changed.


\end{document}